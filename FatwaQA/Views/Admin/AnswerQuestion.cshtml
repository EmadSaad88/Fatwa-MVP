@model FatwaQA.Models.Question

@{
    ViewData["Title"] = "Answer Question";
}

<div class="container-fluid py-5">
    <!-- Header -->
    <div class="row mb-5">
        <div class="col-md-8">
            <h1 class="fw-bold" style="color: #1e40af;">
                <i class="fas fa-reply me-2"></i>Review & Answer Question
            </h1>
        </div>
        <div class="col-md-4 text-end">
            <a asp-action="ManageQuestions" asp-route-status="@Model.Status" class="btn btn-outline-secondary">
                <i class="fas fa-arrow-left me-2"></i>Back
            </a>
        </div>
    </div>

    <div class="row g-4">
        <!-- Main Content Area -->
        <div class="col-lg-8">
            <!-- Question Details Card -->
            <div class="card border-0 shadow-medium mb-4">
                <div class="card-header" style="background: linear-gradient(90deg, #1e40af 0%, #0ea5e9 100%); border: none;">
                    <h5 class="mb-0 text-white fw-bold">
                        <i class="fas fa-question-circle me-2"></i>Question Details
                    </h5>
                </div>
                <div class="card-body p-4">
                    <h4 class="fw-bold mb-3" style="color: #1e40af;">@Model.Title</h4>
                    
                    <div class="d-flex flex-wrap gap-2 align-items-center mb-4 pb-3 border-bottom">
                        <span class="badge bg-light text-dark">
                            <i class="fas fa-tag me-1"></i>@Model.Category
                        </span>
                        <span class="text-muted small">
                            <i class="fas fa-user me-1"></i>@Model.SubmitterName
                        </span>
                        <span class="text-muted small">
                            <i class="fas fa-calendar me-1"></i>@Model.SubmittedDate.ToString("MMM dd, yyyy")
                        </span>
                    </div>

                    <div class="question-section p-4 rounded-3 mb-0">
                        <h6 class="fw-bold mb-3" style="color: #1e40af;">
                            <i class="fas fa-file-alt me-2"></i>Question Text
                        </h6>
                        <div style="color: #374151; line-height: 1.8; white-space: pre-wrap;">
                            @Html.Raw(Model.Content.Replace(Environment.NewLine, "<br />"))
                        </div>
                    </div>
                </div>
            </div>

            <!-- Status Alert -->
            @if (Model.Status != "Pending")
            {
                <div class="alert" role="alert" 
                     style="background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(5, 150, 105, 0.1) 100%); border-left: 5px solid #10b981; border: none;">
                    <strong><i class="fas fa-info-circle me-2"></i>Status Update:</strong>
                    <br/>This question is marked as <span class="badge" style="background: #10b981;">@Model.Status</span>
                    @if (Model.AnsweredBy != null && Model.UpdatedDate.HasValue)
                    {
                        <br/>
                        <small class="text-muted">
                            Answered by <strong>@Model.AnsweredBy.FullName</strong> on @Model.UpdatedDate.Value.ToString("MMMM dd, yyyy")
                        </small>
                    }
                </div>
            }

            <!-- Answer Form Card -->
            <div class="card border-0 shadow-medium">
                <div class="card-header" style="background: linear-gradient(90deg, #10b981 0%, #059669 100%); border: none;">
                    <h5 class="mb-0 text-white fw-bold">
                        <i class="fas fa-pen-fancy me-2"></i>Your Answer
                    </h5>
                </div>
                <div class="card-body p-4">
                    <form method="post" asp-action="AnswerQuestion" novalidate>
                        <input type="hidden" name="id" value="@Model.Id" />
                        
                        <!-- Answer Textarea -->
                        <div class="mb-4">
                            <label for="answer" class="form-label fw-bold">
                                Answer Text 
                                <span style="color: var(--danger-color);">*</span>
                            </label>
                            <textarea id="answer" name="answer" class="form-control form-control-lg" rows="10" required 
                                      placeholder="Provide a detailed and helpful answer based on Islamic knowledge..."
                                      style="border: 2px solid #e2e8f0; border-radius: 8px; padding: 0.75rem; font-family: 'Segoe UI', sans-serif;">@Model.Answer</textarea>
                            <small class="form-text text-muted d-block mt-2">
                                <i class="fas fa-lightbulb me-1"></i>Be clear, comprehensive, and cite Islamic principles when applicable.
                            </small>
                        </div>

                        <!-- Publish Warning Alert -->
                        <div class="alert alert-warning border-0 mb-4" role="alert" 
                             style="background: linear-gradient(135deg, rgba(245, 158, 11, 0.1) 0%, rgba(217, 119, 6, 0.1) 100%); border-left: 5px solid #f59e0b;">
                            <div class="d-flex gap-3">
                                <div>
                                    <i class="fas fa-exclamation-triangle fs-4" style="color: #f59e0b;"></i>
                                </div>
                                <div>
                                    <strong>⚠️ Important Notice:</strong>
                                    <p class="mb-0">You must check "Publish" below to make this answer visible to the public!</p>
                                </div>
                            </div>
                        </div>

                        <!-- Publish Checkbox -->
                        <div class="card border-0 p-4 mb-4" style="background: linear-gradient(135deg, rgba(30, 64, 175, 0.05) 0%, rgba(14, 165, 233, 0.05) 100%); border-left: 5px solid #1e40af;">
                            <div class="form-check">
                                <input type="checkbox" id="publish" name="publish" value="true" class="form-check-input" 
                                    @if (Model.IsPublished) { <text>checked</text> } />
                                <label class="form-check-label fw-bold" for="publish">
                                    <i class="fas fa-globe me-2" style="color: #1e40af;"></i>Publish this answer to public view
                                </label>
                                <br />
                                <small class="text-muted d-block mt-2">
                                    <i class="fas fa-info-circle me-1"></i>Without this checkbox, the answer will only be visible in the admin panel.
                                </small>
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="d-flex gap-2">
                            <button type="submit" class="btn btn-success btn-lg">
                                <i class="fas fa-save me-2"></i>Save Answer
                            </button>
                            <a asp-action="ManageQuestions" asp-route-status="@Model.Status" class="btn btn-outline-secondary btn-lg">
                                <i class="fas fa-times me-2"></i>Cancel
                            </a>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="col-lg-4">
            <!-- Status Card -->
            <div class="card border-0 shadow-soft mb-4">
                <div class="card-header bg-light border-bottom">
                    <h6 class="mb-0 fw-bold">
                        <i class="fas fa-info-circle me-2" style="color: #1e40af;"></i>Question Status
                    </h6>
                </div>
                <div class="card-body">
                    <div class="status-info mb-4">
                        <p class="text-muted small mb-2">Current Status:</p>
                        <p>
                            <span class="badge px-3 py-2" style="background: @(Model.Status == "Pending" ? "linear-gradient(135deg, #f59e0b 0%, #d97706 100%)" : Model.Status == "Answered" ? "linear-gradient(135deg, #10b981 0%, #059669 100%)" : "linear-gradient(135deg, #ef4444 0%, #dc2626 100%)"); color: white;">
                                @Model.Status
                            </span>
                        </p>
                    </div>

                    <hr />

                    <div class="published-info">
                        <p class="text-muted small mb-2">Published Status:</p>
                        <p>
                            @if (Model.IsPublished)
                            {
                                <span class="badge px-3 py-2" style="background: linear-gradient(135deg, #06b6d4 0%, #0891b2 100%); color: white;">
                                    <i class="fas fa-check me-1"></i>Published
                                </span>
                            }
                            else
                            {
                                <span class="badge px-3 py-2" style="background: linear-gradient(135deg, #64748b 0%, #475569 100%); color: white;">
                                    <i class="fas fa-lock me-1"></i>Not Published
                                </span>
                            }
                        </p>
                    </div>
                </div>
            </div>

            <!-- Submitter Info Card -->
            <div class="card border-0 shadow-soft mb-4">
                <div class="card-header bg-light border-bottom">
                    <h6 class="mb-0 fw-bold">
                        <i class="fas fa-user me-2" style="color: #1e40af;"></i>Submitter Information
                    </h6>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <small class="text-muted d-block mb-1">Name</small>
                        <p class="mb-0 fw-bold">@Model.SubmitterName</p>
                    </div>
                    <div class="mb-0">
                        <small class="text-muted d-block mb-1">Email</small>
                        <p class="mb-0">
                            <a href="mailto:@Model.SubmitterEmail" class="text-decoration-none">
                                <i class="fas fa-envelope me-1"></i>@Model.SubmitterEmail
                            </a>
                        </p>
                    </div>
                </div>
            </div>

            <!-- Reject Button (if pending) -->
            @if (Model.Status == "Pending")
            {
                <form method="post" asp-action="RejectQuestion">
                    <input type="hidden" name="id" value="@Model.Id" />
                    <button type="submit" class="btn btn-danger btn-lg w-100" 
                            onclick="return confirm('Are you sure you want to reject this question? This action cannot be undone.');">
                        <i class="fas fa-ban me-2"></i>Reject Question
                    </button>
                </form>
            }
        </div>
    </div>
</div>

<style>
    .question-section {
        background: linear-gradient(135deg, rgba(30, 64, 175, 0.05) 0%, rgba(14, 165, 233, 0.05) 100%);
        border-left: 5px solid #1e40af;
    }
</style>
